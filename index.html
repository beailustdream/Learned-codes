<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lista de Tarefas</title>
  <style>
    :root {
      --bg: #0f172a;          /* slate-900 */
      --panel: #111827;       /* gray-900 */
      --muted: #94a3b8;       /* slate-400 */
      --text: #e5e7eb;        /* gray-200 */
      --accent: #22c55e;      /* green-500 */
      --accent-2: #3b82f6;    /* blue-500 */
      --danger: #ef4444;      /* red-500 */
      --warning: #f59e0b;     /* amber-500 */
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
      background: radial-gradient(1200px 800px at 10% 0%, #1f2937 0%, var(--bg) 40%),
                  radial-gradient(1000px 600px at 100% 100%, #0b1020 0%, var(--bg) 60%);
      color: var(--text);
      display: grid; place-items: center; padding: 24px;
    }

    .app {
      width: 100%; max-width: 720px; background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.08); border-radius: var(--radius);
      box-shadow: var(--shadow); backdrop-filter: blur(8px);
    }

    header { padding: 28px 24px 10px 24px; }
    header h1 { margin: 0; font-size: 28px; letter-spacing: .5px; }
    header p { margin: 6px 0 0; color: var(--muted); font-size: 14px; }

    .controls { display: grid; grid-template-columns: 1fr auto; gap: 10px; padding: 16px 24px 8px; }
    .input {
      display: flex; gap: 10px; align-items: center; background: #0b1222; border: 1px solid rgba(255,255,255,.08);
      padding: 10px 12px; border-radius: 12px;
    }
    .input input[type="text"] {
      flex: 1; background: transparent; border: none; outline: none; color: var(--text); font-size: 16px;
    }
    .input button { white-space: nowrap; }

    button, .chip, .icon-btn {
      border: none; outline: none; cursor: pointer; border-radius: 12px; padding: 10px 14px; font-weight: 600; color: #0b1222;
      transition: transform .04s ease, filter .2s ease, background .2s ease, border-color .2s ease;
      background: var(--accent); box-shadow: 0 6px 18px rgba(34,197,94,.25);
    }
    button:active { transform: translateY(1px); }
    .btn-secondary { background: #182033; color: var(--text); border: 1px solid rgba(255,255,255,.06); box-shadow: none; }

    .filters { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; justify-content: flex-end; }
    .chip { background: #0b1222; color: var(--text); padding: 8px 12px; border-radius: 999px; border: 1px solid rgba(255,255,255,.08); }
    .chip[aria-pressed="true"] { background: var(--accent-2); color: white; border-color: transparent; }

    .search-wrap { padding: 0 24px 8px; }
    .search-wrap input { width: 100%; padding: 10px 12px; border-radius: 12px; background: #0b1222; border: 1px solid rgba(255,255,255,.08); color: var(--text); }

    ul#todo-list { list-style: none; margin: 0; padding: 8px 12px 12px; }
    .item { display: grid; grid-template-columns: auto 1fr auto; align-items: center; gap: 10px; padding: 12px; border-radius: 14px; }
    .item + .item { margin-top: 6px; }
    .item:hover { background: rgba(255,255,255,.04); }

    .check { appearance: none; width: 22px; height: 22px; border-radius: 6px; border: 2px solid #334155; display: grid; place-items: center; cursor: pointer; }
    .check:checked { background: var(--accent); border-color: var(--accent); }
    .check:checked::after { content: "âœ“"; font-weight: 900; color: #05130a; }

    .title { font-size: 16px; line-height: 1.3; }
    .done .title { text-decoration: line-through; color: var(--muted); }

    .actions { display: flex; gap: 6px; }
    .icon-btn { background: #15203a; color: var(--text); padding: 8px 10px; border-radius: 10px; border: 1px solid rgba(255,255,255,.08); }
    .icon-btn:hover { filter: brightness(1.2); }
    .icon-btn.warning { background: #2b1c05; border-color: rgba(245, 158, 11, .4); }
    .icon-btn.danger { background: #2a1214; border-color: rgba(239, 68, 68, .4); }

    footer { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; justify-content: space-between; padding: 12px 24px 24px; color: var(--muted); font-size: 14px; }
    .count strong { color: var(--text); }

    .empty { text-align: center; color: var(--muted); padding: 24px; }

    @media (max-width: 520px) {
      .controls { grid-template-columns: 1fr; }
      .filters { justify-content: flex-start; }
    }
  </style>
</head>
<body>
  <div class="app" role="application" aria-labelledby="title">
    <header>
      <h1 id="title">Lista de Tarefas</h1>
      <p>Adicione, marque como concluÃ­da, edite e filtre. Tudo salvo automaticamente no seu navegador.</p>
    </header>

    <div class="controls" aria-label="Adicionar tarefa e filtros">
      <div class="input" role="group" aria-label="Adicionar tarefa">
        <input id="new-todo" type="text" placeholder="O que precisa fazer? (Enter para adicionar)" autocomplete="off" />
        <button id="add-btn" aria-label="Adicionar tarefa">Adicionar</button>
      </div>
      <div class="filters" role="group" aria-label="Filtros de tarefas">
        <button class="chip" data-filter="all" aria-pressed="true">Todas</button>
        <button class="chip" data-filter="active" aria-pressed="false">Ativas</button>
        <button class="chip" data-filter="done" aria-pressed="false">ConcluÃ­das</button>
      </div>
    </div>

    <div class="search-wrap">
      <input id="search" type="search" placeholder="Pesquisar tarefasâ€¦" aria-label="Pesquisar tarefas" />
    </div>

    <ul id="todo-list" aria-live="polite" aria-label="Lista de tarefas"></ul>

    <div class="empty" id="empty" hidden>Nenhuma tarefa por aquiâ€¦ âœ¨</div>

    <footer>
      <div class="count">Restantes: <strong id="count">0</strong></div>
      <div class="footer-actions">
        <button id="clear-done" class="btn-secondary" aria-label="Limpar concluÃ­das">Limpar concluÃ­das</button>
        <button id="export" class="btn-secondary" aria-label="Exportar tarefas">Exportar</button>
        <button id="import" class="btn-secondary" aria-label="Importar tarefas">Importar</button>
      </div>
    </footer>
  </div>

  <template id="item-template">
    <li class="item" draggable="true">
      <input type="checkbox" class="check" aria-label="Concluir tarefa" />
      <div class="title" tabindex="0"></div>
      <div class="actions">
        <button class="icon-btn" data-action="edit" title="Editar" aria-label="Editar">âœŽ</button>
        <button class="icon-btn warning" data-action="duplicate" title="Duplicar" aria-label="Duplicar">â§‰</button>
        <button class="icon-btn danger" data-action="delete" title="Excluir" aria-label="Excluir">ðŸ—‘</button>
      </div>
    </li>
  </template>

  <script>
    (function() {
      const STORAGE_KEY = 'todos-v1';
      /** @type {{id:string,text:string,done:boolean,order:number}[]} */
      let todos = [];
      let filter = 'all';
      let searchQuery = '';

      // Elements
      const list = document.getElementById('todo-list');
      const empty = document.getElementById('empty');
      const input = document.getElementById('new-todo');
      const addBtn = document.getElementById('add-btn');
      const search = document.getElementById('search');
      const count = document.getElementById('count');
      const clearDoneBtn = document.getElementById('clear-done');
      const exportBtn = document.getElementById('export');
      const importBtn = document.getElementById('import');

      // Load
      try { todos = JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; } catch { todos = []; }
      normalizeOrder();
      render();

      // Events
      addBtn.addEventListener('click', () => tryAdd());
      input.addEventListener('keydown', (e) => { if (e.key === 'Enter') tryAdd(); });
      search.addEventListener('input', () => { searchQuery = search.value.trim().toLowerCase(); render(); });

      document.querySelectorAll('.filters .chip').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.filters .chip').forEach(b => b.setAttribute('aria-pressed', 'false'));
          btn.setAttribute('aria-pressed', 'true');
          filter = btn.dataset.filter;
          render();
        });
      });

      clearDoneBtn.addEventListener('click', () => {
        todos = todos.filter(t => !t.done);
        save();
        render();
      });

      exportBtn.addEventListener('click', () => {
        const blob = new Blob([JSON.stringify(todos, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'tarefas.json'; a.click();
        URL.revokeObjectURL(url);
      });

      importBtn.addEventListener('click', async () => {
        const inputFile = document.createElement('input');
        inputFile.type = 'file';
        inputFile.accept = 'application/json';
        inputFile.onchange = () => {
          const file = inputFile.files[0]; if (!file) return;
          const reader = new FileReader();
          reader.onload = () => {
            try {
              const data = JSON.parse(reader.result);
              if (Array.isArray(data)) {
                todos = data.map((t, i) => ({ id: uid(), text: String(t.text ?? ''), done: !!t.done, order: i }));
                save();
                render();
              } else alert('Arquivo invÃ¡lido.');
            } catch { alert('NÃ£o foi possÃ­vel ler o arquivo.'); }
          };
          reader.readAsText(file);
        };
        inputFile.click();
      });

      // Drag & Drop reorder
      let dragId = null;
      list.addEventListener('dragstart', (e) => {
        const li = e.target.closest('li.item');
        if (!li) return;
        dragId = li.dataset.id;
        e.dataTransfer.effectAllowed = 'move';
      });
      list.addEventListener('dragover', (e) => {
        e.preventDefault();
        const over = e.target.closest('li.item');
        if (!over || over.dataset.id === dragId) return;
        const dragIdx = todos.findIndex(t => t.id === dragId);
        const overIdx = todos.findIndex(t => t.id === over.dataset.id);
        const draggingDown = dragIdx < overIdx;
        list.insertBefore(document.querySelector(`li.item[data-id="${dragId}"]`), draggingDown ? over.nextSibling : over);
      });
      list.addEventListener('drop', () => {
        const items = [...list.querySelectorAll('li.item')];
        items.forEach((li, i) => {
          const todo = todos.find(t => t.id === li.dataset.id);
          if (todo) todo.order = i;
        });
        todos.sort((a,b)=>a.order-b.order);
        save();
      });

      function tryAdd() {
        const text = input.value.trim();
        if (!text) return;
        todos.push({ id: uid(), text, done: false, order: todos.length });
        input.value = '';
        save();
        render(true);
      }

      function render(focusLast=false) {
        const frag = document.createDocumentFragment();
        const template = document.getElementById('item-template');
        const filtered = todos
          .filter(t => filter === 'all' || (filter === 'active' ? !t.done : t.done))
          .filter(t => t.text.toLowerCase().includes(searchQuery))
          .sort((a,b) => a.order - b.order);

        list.innerHTML = '';
        filtered.forEach(t => {
          const node = template.content.cloneNode(true);
          const li = node.querySelector('li');
          li.dataset.id = t.id;
          if (t.done) li.classList.add('done');

          const check = node.querySelector('.check');
          check.checked = t.done;
          check.addEventListener('change', () => toggle(t.id));

          const title = node.querySelector('.title');
          title.textContent = t.text;
          title.addEventListener('dblclick', () => startEdit(li, t));
          title.addEventListener('keydown', (e) => { if (e.key === 'Enter') startEdit(li, t); });

          node.querySelector('[data-action="edit"]').addEventListener('click', () => startEdit(li, t));
          node.querySelector('[data-action="duplicate"]').addEventListener('click', () => duplicate(t.id));
          node.querySelector('[data-action="delete"]').addEventListener('click', () => remove(t.id));

          frag.appendChild(node);
        });
        list.appendChild(frag);

        const remaining = todos.filter(t => !t.done).length;
        count.textContent = remaining;
        empty.hidden = filtered.length !== 0;

        if (focusLast) {
          const last = list.lastElementChild?.querySelector('.title');
          last?.focus();
        }
      }

      function startEdit(li, todo) {
        const current = li.querySelector('.title');
        const input = document.createElement('input');
        input.type = 'text'; input.value = todo.text; input.className = 'title'; input.style.background = 'transparent';
        li.replaceChild(input, current);
        input.focus(); input.select();

        const commit = () => {
          const v = input.value.trim();
          if (!v) { remove(todo.id); return; }
          todo.text = v; save(); render();
        };
        input.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') commit();
          if (e.key === 'Escape') render();
        });
        input.addEventListener('blur', commit);
      }

      function toggle(id) {
        const t = todos.find(x => x.id === id);
        if (!t) return; t.done = !t.done; save(); render();
      }

      function remove(id) {
        const idx = todos.findIndex(x => x.id === id);
        if (idx >= 0) { todos.splice(idx,1); normalizeOrder(); save(); render(); }
      }

      function duplicate(id) {
        const t = todos.find(x => x.id === id);
        if (!t) return;
        const copy = { ...t, id: uid(), text: t.text + ' (cÃ³pia)', order: (t.order ?? 0) + 0.5 };
        todos.push(copy);
        reindexOrder();
        save();
        render(true);
      }

      function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify(todos)); }

      function uid() { return Math.random().toString(36).slice(2, 10) + Date.now().toString(36).slice(-4); }

      function normalizeOrder() {
        todos.sort((a,b)=> (a.order ?? 0) - (b.order ?? 0));
        reindexOrder();
      }
      function reindexOrder() { todos.forEach((t,i)=> t.order = i); }
    })();
  </script>
</body>
</html>

